# Vulnerability Catalog

IPAガイドラインに基づく11種類の脆弱性カタログ。各脆弱性の概要と対応する詳細資料へのリンクを提供する。

## Table of Contents

- [Vulnerability Overview](#vulnerability-overview)
- [Priority-Based Diagnosis](#priority-based-diagnosis)
  - [高優先度 (Critical Impact)](#高優先度-critical-impact)
  - [中優先度 (Important)](#中優先度-important)
  - [低優先度 (Recommended)](#低優先度-recommended)
- [Code-Based Diagnosis Mapping](#code-based-diagnosis-mapping)
  - [Laravel Backend](#laravel-backend)
  - [React Frontend](#react-frontend)
  - [API Endpoints](#api-endpoints)
- [Laravel Framework Built-in Protections](#laravel-framework-built-in-protections)
- [React Built-in Protections](#react-built-in-protections)
- [Diagnosis Decision Tree](#diagnosis-decision-tree)
- [Reference Files Structure](#reference-files-structure)

---

## Vulnerability Overview

| # | 脆弱性名 | IPA届出状況 | 重要度 | 詳細資料 |
|---|---------|------------|--------|---------|
| 1 | SQLインジェクション | 上位 | 高 | [injection.md](injection.md#sql-injection) |
| 2 | OSコマンド・インジェクション | - | 中 | [injection.md](injection.md#os-command-injection) |
| 3 | ディレクトリ・トラバーサル | - | 中 | [injection.md](injection.md#directory-traversal) |
| 4 | クロスサイト・スクリプティング（XSS） | 約5割 | 高 | [xss.md](xss.md) |
| 5 | CSRF | - | 高 | [csrf-session.md](csrf-session.md#csrf) |
| 6 | セッション管理の不備 | - | 高 | [csrf-session.md](csrf-session.md#session-management) |
| 7 | HTTPヘッダ・インジェクション | - | 中 | [http-headers.md](http-headers.md#http-header-injection) |
| 8 | メールヘッダ・インジェクション | - | 低 | [http-headers.md](http-headers.md#mail-header-injection) |
| 9 | クリックジャッキング | - | 低 | [http-headers.md](http-headers.md#clickjacking) |
| 10 | アクセス制御・認可制御の欠落（IDOR） | - | 高 | [access-control.md](access-control.md#idor) |
| 11 | パスワード管理・認証の不備 | - | 高 | [access-control.md](access-control.md#password-management) |

## Priority-Based Diagnosis

脆弱性診断の優先順位:

### 高優先度 (Critical Impact)

**必須診断項目** - 深刻な影響を及ぼす可能性が高い:

1. **SQLインジェクション**
   - 影響: データベース全体の漏洩・改ざん
   - 対象: DB接続を行う全てのコード

2. **XSS（クロスサイト・スクリプティング）**
   - 影響: セッションハイジャック、フィッシング
   - 対象: ユーザー入力を出力する全てのコード

3. **CSRF（クロスサイト・リクエスト・フォージェリ）**
   - 影響: 不正操作の強制実行
   - 対象: 状態変更を行う全てのフォーム・API

4. **アクセス制御の欠落（IDOR）**
   - 影響: 他ユーザーのデータへの不正アクセス
   - 対象: リソースアクセスを行う全てのエンドポイント

5. **セッション管理の不備**
   - 影響: なりすましアクセス
   - 対象: 認証機能全般

### 中優先度 (Important)

**推奨診断項目** - 重要な影響を及ぼす可能性:

6. **OSコマンド・インジェクション**
   - 影響: サーバの完全掌握
   - 対象: OSコマンド実行を行うコード

7. **ディレクトリ・トラバーサル**
   - 影響: 機密ファイルの閲覧
   - 対象: ファイル操作を行うコード

8. **パスワード管理の不備**
   - 影響: 認証情報の漏洩
   - 対象: パスワード処理を行うコード

### 低優先度 (Recommended)

**補完診断項目** - セキュリティ強化のため推奨:

9. **HTTPヘッダ・インジェクション**
   - 影響: XSSと同等（条件付き）
   - 対象: HTTPヘッダを動的生成するコード

10. **メールヘッダ・インジェクション**
    - 影響: スパムメールの踏み台
    - 対象: メール送信機能

11. **クリックジャッキング**
    - 影響: 意図しないクリック操作
    - 対象: iframe埋め込みが可能な全ページ

## Code-Based Diagnosis Mapping

コード種別ごとの診断対象脆弱性:

### Laravel Backend

| コード種別 | 診断対象脆弱性 |
|-----------|--------------|
| **Controller** | CSRF, アクセス制御, HTTPヘッダ |
| **UseCase** | アクセス制御, ビジネスロジック |
| **Repository** | SQLインジェクション |
| **Model** | SQLインジェクション |
| **Request** | 入力値検証（全脆弱性の基礎） |
| **Middleware** | 認証, セッション管理, CSRF |
| **Blade View** | XSS, CSRF |
| **Mailable** | メールヘッダインジェクション |

### React Frontend

| コード種別 | 診断対象脆弱性 |
|-----------|--------------|
| **Component** | XSS, CSRF（フォーム） |
| **Hook** | アクセス制御（認可チェック） |
| **Form** | CSRF, XSS |
| **API Client** | CSRF（クレデンシャル設定） |

### API Endpoints

| エンドポイント種別 | 診断対象脆弱性 |
|----------------|--------------|
| **GET** | アクセス制御, SQLインジェクション, XSS |
| **POST** | CSRF, SQLインジェクション, アクセス制御 |
| **PUT/PATCH** | CSRF, SQLインジェクション, アクセス制御 |
| **DELETE** | CSRF, アクセス制御 |
| **File Upload** | ディレクトリトラバーサル, ファイル検証 |

## Laravel Framework Built-in Protections

Laravelが標準で提供するセキュリティ機能:

| 機能 | 対策内容 | 使用方法 |
|------|----------|---------|
| **Eloquent ORM** | SQLインジェクション防止 | `User::where('email', $email)->first()` |
| **Blade `{{ }}`** | XSS防止（自動エスケープ） | `{{ $content }}` |
| **@csrf** | CSRF対策 | `<form>@csrf</form>` |
| **Hash::make()** | パスワードハッシュ | `Hash::make($password)` |
| **Policy** | アクセス制御 | `$this->authorize('view', $post)` |
| **Throttle** | レート制限 | `->middleware('throttle:5,1')` |

**重要**: これらの機能を**正しく使用している場合**は脆弱性なしと判定する。

## React Built-in Protections

Reactが標準で提供するセキュリティ機能:

| 機能 | 対策内容 | 使用方法 |
|------|----------|---------|
| **JSX自動エスケープ** | XSS防止 | `<div>{userInput}</div>` |
| **DOMPurify** | HTMLサニタイゼーション | `DOMPurify.sanitize(html)` |
| **Axios withCredentials** | CSRF Cookie送信 | `withCredentials: true` |
| **Axios withXSRFToken** | XSRFトークン送信 | `withXSRFToken: true` |

## Diagnosis Decision Tree

診断対象の判定フローチャート:

```
コードを受け取る
    ↓
コード種別を判定
    ├─ Backend (Laravel)
    │   ├─ Controller → CSRF, アクセス制御, HTTPヘッダ
    │   ├─ Repository/Model → SQLインジェクション
    │   ├─ Blade View → XSS, CSRF
    │   └─ Middleware → 認証, セッション
    │
    ├─ Frontend (React)
    │   ├─ Component → XSS
    │   ├─ Form → CSRF, XSS
    │   └─ API Client → CSRF設定
    │
    └─ API Endpoint
        ├─ GET → アクセス制御, SQL, XSS
        ├─ POST/PUT/PATCH → CSRF, SQL, アクセス制御
        └─ DELETE → CSRF, アクセス制御
            ↓
該当する references/*.md を読み込む
            ↓
脆弱性パターンと照合
            ↓
診断結果をレポート
```

## Reference Files Structure

各詳細資料の構成:

### injection.md
- SQL Injection
- OS Command Injection
- Directory Traversal

### xss.md
- Laravel/Blade XSS prevention
- React XSS prevention
- Content Security Policy (CSP)

### csrf-session.md
- CSRF (Cross-Site Request Forgery)
- Session Management
- Laravel Sanctum configuration

### http-headers.md
- HTTP Header Injection
- Mail Header Injection
- Clickjacking
- Security Headers Middleware

### access-control.md
- Access Control & IDOR prevention
- Laravel Policy implementation
- Password Management
- Authentication & Rate Limiting

### checklist.md
- Comprehensive implementation checklist
- Environment configuration
- Code review guidelines
