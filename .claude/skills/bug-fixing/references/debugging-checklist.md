# バグ調査チェックリスト

## 1. バグの再現確認

### 再現手順の確認
- [ ] ユーザー報告の再現手順を正確に理解する
- [ ] 同じ環境（ブラウザ、デバイス、OS）で再現を試みる
- [ ] 再現の成功/失敗を記録する
- [ ] 再現条件を特定する（特定の状態、データ、タイミングなど）

### 環境の確認
- [ ] 本番環境でのみ発生するか、開発環境でも再現するか
- [ ] 特定のブラウザ/デバイスでのみ発生するか
- [ ] 認証状態（ログイン済み/未ログイン）の影響
- [ ] ネットワーク状態の影響（オンライン/オフライン、低速回線）

---

## 2. ログとエラーメッセージの確認

### バックエンドログ
- [ ] Laravel logs (`storage/logs/laravel.log`)
- [ ] エラースタックトレース
- [ ] SQLクエリログ（デバッグバーまたはクエリログ）
- [ ] 該当時間帯のログを抽出

### フロントエンドログ
- [ ] ブラウザコンソールエラー
- [ ] ネットワークタブ（失敗したリクエスト、ステータスコード）
- [ ] React DevTools（状態、props、コンポーネント階層）
- [ ] ソースマップでエラー発生箇所を特定

### データベース
- [ ] データの整合性チェック
- [ ] 外部キー制約違反の確認
- [ ] インデックスの有無確認

---

## 3. コードの静的解析

### 変更履歴の確認
- [ ] `git log` で最近の変更を確認
- [ ] `git blame` で該当コードの変更履歴を確認
- [ ] 関連するPR/コミットを確認

### コードレビュー
- [ ] 該当機能の実装コードを読む
- [ ] 依存関係を確認（呼び出し元・呼び出し先）
- [ ] 型定義の確認（TypeScript、PHPDoc）
- [ ] バリデーションルールの確認

### 静的解析ツール
- [ ] TypeScript型エラー（`bun run typecheck`）
- [ ] PHPStan（`./vendor/bin/phpstan analyse`）
- [ ] Lintエラー（`bun run check`, `./vendor/bin/pint --test`）

---

## 4. 影響範囲の調査

### 同じコードを使用している箇所
- [ ] Grep検索で類似パターンを探す
- [ ] LSP（Language Server Protocol）で参照箇所を確認
- [ ] 共通コンポーネント、共通関数の使用箇所

### 関連機能
- [ ] 同じエンティティを扱う他の機能
- [ ] 同じAPIエンドポイントを使用する他の画面
- [ ] 共通のバリデーションルールを使用する機能

### データへの影響
- [ ] 既存データの整合性
- [ ] マイグレーション実行の必要性
- [ ] データ修正スクリプトの必要性

---

## 5. 根本原因の特定

### 仮説の立案
- [ ] エラーメッセージから仮説を立てる
- [ ] ログから異常な挙動を特定
- [ ] コードレビューで論理エラーを発見

### デバッグ実行
- [ ] `dd()`, `dump()` でデータ確認（Laravel）
- [ ] `console.log()` で状態確認（React）
- [ ] ブレークポイントでステップ実行
- [ ] Xdebug/React DevToolsでデバッグ

### 分岐の確認
- [ ] 条件分岐の全パターンを確認
- [ ] エッジケース（null、空配列、0、空文字）の処理
- [ ] エラーハンドリングの有無

---

## 6. 修正案の検討

### 修正方針の決定
- [ ] 根本原因を解決する修正か
- [ ] 影響範囲を最小化できるか
- [ ] 既存の設計パターンに沿っているか

### セキュリティの確認
- [ ] XSS、SQLインジェクション等の脆弱性がないか
- [ ] 認可チェックが適切か
- [ ] 入力値バリデーションが十分か

### パフォーマンスの確認
- [ ] N+1問題を引き起こさないか
- [ ] 不要なクエリ発行がないか
- [ ] フロントエンドのレンダリング負荷

---

## 7. テストの作成

### 修正内容のテスト
- [ ] バグを再現するテストケースを作成
- [ ] 修正後にテストがパスすることを確認
- [ ] エッジケースのテストを追加

### 既存機能への影響確認
- [ ] 既存のテストがすべてパスするか
- [ ] 関連機能のE2Eテスト実行
- [ ] カバレッジの確認

### テスト種別
- [ ] **バックエンド**: Unit/Feature テスト（`./vendor/bin/phpunit`）
- [ ] **フロントエンド**: Vitest + RTL（`bun run test`）
- [ ] **E2E**: 必要に応じて手動確認またはPlaywright

---

## 8. ドキュメントの更新

### コメント
- [ ] 修正箇所に適切なコメントを追加
- [ ] 複雑なロジックの説明

### CHANGELOG
- [ ] バグ修正の内容を記録
- [ ] 影響範囲の明記

### GitHub Issue/PR
- [ ] 修正内容の説明
- [ ] Before/After の動作確認
- [ ] スクリーンショットやログの添付
